- hosts: localhost
  name: Install RHI Demo
  vars:
    demo_delete: false
    demo_project: rhi-demo
    cicd_project: rhi-demo-cicd
    grafana_project: rhi-demo-grafana
    threescale_project: rhi-demo-threescale
    threescale_account_user: rhidemouser
    threescale_account_org: rhi-demo-org
    threescale_account_password: rhidemopassword
    registry_url: quay.io/gcamposo
    ingestor_git: https://gitlab.com/rhi-demo/salesforce-webhook-ingestor.git
    asana_adapter_git: https://gitlab.com/rhi-demo/asana-adapter.git
    insecure_skip_tls_verify: true
    enable_logging: true
    enable_user_workload_monitoring: true
    enable_pipelines: true
    provision_demo: true
    delete_demo: false
  tasks:

    - name: Define domain
      set_fact:
        domain : "{{ server | regex_replace('https://api.') | regex_replace(':6443')   }}"

    - name: login as super user with token on OpenShift 4
      command: "oc login --token={{ token }}  --server={{ server }} --insecure-skip-tls-verify={{ insecure_skip_tls_verify }}"
      when:
       - token is defined
       - server is defined
      ignore_errors: no

    - name: Delete All
      include_tasks: tasks/delete_all.yml
      when: delete_demo | bool

    - name: Provision All
      include_tasks: tasks/provision_all.yml
      when: provision_demo | bool
